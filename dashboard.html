<!doctype html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Fortress Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;700&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="appShell" class="dashboard-layout hidden">
        <aside class="side">
            <div class="logo">Finance Fortress</div>
            <nav class="side-nav">
                <button class="tab-btn active" data-tab-target="dashboardTab">Dashboard</button>
                <button class="tab-btn" data-tab-target="ledgerTab">Ledger</button>
                <button class="tab-btn" data-tab-target="assetsTab">Assets</button>
                <button class="tab-btn" data-tab-target="loansTab">Loans</button>
                <button class="tab-btn" data-tab-target="budgetsTab">Budgets</button>
                <button class="tab-btn" data-tab-target="reportsTab">Reports</button>
            </nav>
            <div class="side-foot">
                <div class="helper" id="userEmailPreview"></div>
            </div>
        </aside>

        <main class="main">
            <div class="mobile-top">
                <button class="tab-btn active" data-tab-target="dashboardTab">Dashboard</button>
                <button class="tab-btn" data-tab-target="ledgerTab">Ledger</button>
                <button class="tab-btn" data-tab-target="assetsTab">Assets</button>
                <button class="tab-btn" data-tab-target="loansTab">Loans</button>
                <button class="tab-btn" data-tab-target="budgetsTab">Budgets</button>
                <button class="tab-btn" data-tab-target="reportsTab">Reports</button>
            </div>

            <header class="topbar">
                <div>
                    <h2 id="sectionHeading">Dashboard Summary</h2>
                    <div class="helper">Default currency: PKR</div>
                </div>
                <div class="topbar-right">
                    <button type="button" class="icon-btn" id="themeToggleBtn" title="Toggle theme">?</button>
                    <button type="button" class="btn btn-primary" id="openTransactionModalBtn">+ Add Transaction</button>
                    <button type="button" class="btn btn-soft" id="logoutBtn">Log Out</button>
                </div>
            </header>

            <section id="dashboardTab" class="tab-content">
                <div class="cards">
                    <article class="card">
                        <h3>Total Income</h3>
                        <div class="value green" id="totalIncomeCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Total Expenses</h3>
                        <div class="value red" id="totalExpenseCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Net Cash Flow</h3>
                        <div class="value blue" id="netCashCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Total Assets</h3>
                        <div class="value amber" id="totalAssetsCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Loan Receivable</h3>
                        <div class="value blue" id="loanReceivableCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Loan Payable</h3>
                        <div class="value red" id="loanPayableCard">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Net Worth</h3>
                        <div class="value" id="netWorthCard">PKR 0</div>
                    </article>
                </div>

                <div class="split">
                    <article class="panel">
                        <h3>Account Balances</h3>
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Account</th>
                                        <th>Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="accountBalanceTableBody"></tbody>
                            </table>
                        </div>
                    </article>

                    <article class="panel">
                        <h3>Cashflow Trend (Last 6 Months)</h3>
                        <canvas id="cashflowChart" height="210"></canvas>
                    </article>
                </div>

                <article class="panel mt-2">
                    <h3>Recent Ledger Entries</h3>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Txn Code</th>
                                    <th>Date</th>
                                    <th>Detail</th>
                                    <th>Type</th>
                                    <th>Account</th>
                                    <th>Head</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentTransactionsBody"></tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="ledgerTab" class="tab-content hidden">
                <article class="panel">
                    <h3>Ledger Filters</h3>
                    <div class="filters">
                        <select id="filterType" class="select"></select>
                        <select id="filterAccount" class="select"></select>
                        <select id="filterHead" class="select"></select>
                        <input class="input" id="filterFromDate" type="date">
                        <input class="input" id="filterToDate" type="date">
                        <input class="input" id="filterSearch" type="text" placeholder="Search detail/notes/code">
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" id="applyLedgerFiltersBtn" type="button">Apply Filters</button>
                        <button class="btn btn-soft" id="resetLedgerFiltersBtn" type="button">Reset</button>
                        <span class="helper" id="ledgerCount">0 entries</span>
                    </div>
                </article>

                <article class="panel">
                    <h3>Ledger Entries</h3>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Txn Code</th>
                                    <th>Event Date</th>
                                    <th>Created</th>
                                    <th>Type</th>
                                    <th>Detail</th>
                                    <th>Account</th>
                                    <th>Head</th>
                                    <th>Amount</th>
                                    <th>Notes / Audit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ledgerTableBody"></tbody>
                        </table>
                    </div>
                </article>

                <article class="panel">
                    <h3>Bulk Add Transactions</h3>
                    <p class="helper">Accepted CSV columns: detail, amount, flowType, account, head, date, time, notes</p>
                    <div class="grid-2">
                        <div>
                            <div class="field">
                                <label for="bulkCsvFile">CSV File</label>
                                <input id="bulkCsvFile" class="input" type="file" accept=".csv">
                            </div>
                            <button class="btn btn-soft" id="readBulkCsvFileBtn" type="button">Load File Into Text Area</button>
                        </div>
                        <div>
                            <div class="field">
                                <label for="bulkCsvText">CSV Text</label>
                                <textarea id="bulkCsvText" class="textarea" placeholder="detail,amount,flowType,account,head,date,time,notes"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-success" id="processBulkCsvBtn" type="button">Process Bulk Import</button>
                    </div>
                </article>
            </section>

            <section id="assetsTab" class="tab-content hidden">
                <article class="panel">
                    <h3>Asset Register</h3>
                    <form id="assetForm">
                        <input type="hidden" id="assetEditId">
                        <div class="grid-2">
                            <div class="field">
                                <label for="assetName">Asset Name</label>
                                <input class="input" id="assetName" required type="text" placeholder="Plot in Lahore / Gold / Laptop">
                            </div>
                            <div class="field">
                                <label for="assetCategory">Category</label>
                                <input class="input" id="assetCategory" required type="text" placeholder="Real Estate / Electronics / Precious Metal">
                            </div>
                            <div class="field">
                                <label for="assetLocation">Where Held</label>
                                <input class="input" id="assetLocation" type="text" placeholder="Bank Locker, Home, Broker, etc.">
                            </div>
                            <div class="field">
                                <label for="assetPurchaseDate">Purchase Date</label>
                                <input class="input" id="assetPurchaseDate" type="date">
                            </div>
                            <div class="field">
                                <label for="assetPurchaseValue">Purchase Value (PKR)</label>
                                <input class="input" id="assetPurchaseValue" required type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="assetCurrentValue">Current Value (PKR)</label>
                                <input class="input" id="assetCurrentValue" required type="number" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="field">
                            <label for="assetNotes">Notes</label>
                            <textarea class="textarea" id="assetNotes" placeholder="Any details, valuation notes, ownership references"></textarea>
                        </div>
                        <div class="btn-row">
                            <button class="btn btn-primary" id="saveAssetBtn" type="submit">Save Asset</button>
                            <button class="btn btn-soft hidden" id="cancelAssetEditBtn" type="button">Cancel Edit</button>
                        </div>
                    </form>
                </article>

                <article class="panel">
                    <h3>Assets List</h3>
                    <div class="helper">Total Current Asset Worth: <strong id="totalAssetsWorth">PKR 0</strong></div>
                    <div class="table-wrap mt-1">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Location</th>
                                    <th>Purchase</th>
                                    <th>Current</th>
                                    <th>Gain/Loss</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="assetsTableBody"></tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="loansTab" class="tab-content hidden">
                <article class="panel">
                    <h3>Loan Tracker</h3>
                    <form id="loanForm">
                        <input type="hidden" id="loanEditId">
                        <div class="grid-2">
                            <div class="field">
                                <label for="loanDirection">Loan Type</label>
                                <select class="select" id="loanDirection" required>
                                    <option value="given">Loan You Gave</option>
                                    <option value="taken">Loan You Took</option>
                                </select>
                            </div>
                            <div class="field">
                                <label for="loanParty">Counterparty</label>
                                <input class="input" id="loanParty" required type="text" placeholder="Person or institution name">
                            </div>
                            <div class="field">
                                <label for="loanPrincipal">Principal (PKR)</label>
                                <input class="input" id="loanPrincipal" required type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="loanOutstanding">Outstanding (PKR)</label>
                                <input class="input" id="loanOutstanding" required type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="loanInterestRate">Interest % (optional)</label>
                                <input class="input" id="loanInterestRate" type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="loanDueDate">Due Date</label>
                                <input class="input" id="loanDueDate" type="date">
                            </div>
                            <div class="field">
                                <label for="loanStatus">Status</label>
                                <select class="select" id="loanStatus" required>
                                    <option value="active">Active</option>
                                    <option value="closed">Closed</option>
                                    <option value="overdue">Overdue</option>
                                </select>
                            </div>
                        </div>
                        <div class="field">
                            <label for="loanNotes">Notes</label>
                            <textarea class="textarea" id="loanNotes"></textarea>
                        </div>
                        <div class="btn-row">
                            <button class="btn btn-primary" type="submit">Save Loan</button>
                            <button class="btn btn-soft hidden" id="cancelLoanEditBtn" type="button">Cancel Edit</button>
                        </div>
                    </form>
                </article>

                <div class="cards">
                    <article class="card">
                        <h3>Total Loan Given</h3>
                        <div class="value blue" id="loanGivenTotal">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Total Loan Taken</h3>
                        <div class="value red" id="loanTakenTotal">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Receivable Outstanding</h3>
                        <div class="value blue" id="loanReceivableTotal">PKR 0</div>
                    </article>
                    <article class="card">
                        <h3>Payable Outstanding</h3>
                        <div class="value red" id="loanPayableTotal">PKR 0</div>
                    </article>
                </div>

                <article class="panel">
                    <h3>Loan Records</h3>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Counterparty</th>
                                    <th>Principal</th>
                                    <th>Outstanding</th>
                                    <th>Interest %</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="loansTableBody"></tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="budgetsTab" class="tab-content hidden">
                <article class="panel">
                    <h3>Goal-Based Funds / Budgeting</h3>
                    <form id="budgetForm">
                        <input type="hidden" id="budgetEditId">
                        <div class="grid-2">
                            <div class="field">
                                <label for="budgetName">Fund Name</label>
                                <input class="input" id="budgetName" required type="text" list="budgetNameList" placeholder="Emergency Fund / Education / Travel">
                                <datalist id="budgetNameList"></datalist>
                            </div>
                            <div class="field">
                                <label for="budgetAccount">Linked Account</label>
                                <input class="input" id="budgetAccount" list="accountList" placeholder="Meezan Bank / Cash Wallet">
                            </div>
                            <div class="field">
                                <label for="budgetTarget">Target Amount (PKR)</label>
                                <input class="input" id="budgetTarget" required type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="budgetCurrent">Current Saved (PKR)</label>
                                <input class="input" id="budgetCurrent" required type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="budgetMonthly">Monthly Contribution (PKR)</label>
                                <input class="input" id="budgetMonthly" type="number" min="0" step="0.01">
                            </div>
                            <div class="field">
                                <label for="budgetDeadline">Target Date</label>
                                <input class="input" id="budgetDeadline" type="date">
                            </div>
                        </div>
                        <div class="field">
                            <label for="budgetNotes">Notes</label>
                            <textarea class="textarea" id="budgetNotes"></textarea>
                        </div>
                        <div class="btn-row">
                            <button class="btn btn-primary" type="submit">Save Fund</button>
                            <button class="btn btn-soft hidden" type="button" id="cancelBudgetEditBtn">Cancel Edit</button>
                        </div>
                    </form>
                </article>

                <article class="panel">
                    <h3>Fund Tracker</h3>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fund</th>
                                    <th>Target</th>
                                    <th>Current</th>
                                    <th>Progress</th>
                                    <th>Monthly</th>
                                    <th>Deadline</th>
                                    <th>Account</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="budgetsTableBody"></tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="reportsTab" class="tab-content hidden">
                <article class="panel">
                    <h3>Statements, Filters, and Exports</h3>
                    <div class="filters">
                        <input class="input" id="reportFromDate" type="date">
                        <input class="input" id="reportToDate" type="date">
                        <select id="reportType" class="select"></select>
                        <select id="reportAccount" class="select"></select>
                        <select id="reportHead" class="select"></select>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" id="generateReportBtn" type="button">Generate Report</button>
                        <button class="btn btn-soft" id="resetReportBtn" type="button">Reset</button>
                        <button class="btn btn-soft" id="exportCsvBtn" type="button">Export CSV</button>
                        <button class="btn btn-soft" id="exportPdfBtn" type="button">Export PDF (A4)</button>
                        <button class="btn btn-soft" id="exportPngBtn" type="button">Export PNG</button>
                        <button class="btn btn-soft" id="exportJpgBtn" type="button">Export JPG</button>
                        <button class="btn btn-soft" id="printReportBtn" type="button">Print</button>
                    </div>
                </article>

                <article class="panel report-box" id="reportCaptureArea">
                    <h3>Filtered Report Preview</h3>
                    <div class="cards">
                        <article class="card">
                            <h3>Income</h3>
                            <div class="value green" id="reportIncomeValue">PKR 0</div>
                        </article>
                        <article class="card">
                            <h3>Expense</h3>
                            <div class="value red" id="reportExpenseValue">PKR 0</div>
                        </article>
                        <article class="card">
                            <h3>Net</h3>
                            <div class="value blue" id="reportNetValue">PKR 0</div>
                        </article>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Txn Code</th>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Detail</th>
                                    <th>Account</th>
                                    <th>Head</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody"></tbody>
                        </table>
                    </div>
                </article>
            </section>
        </main>
    </div>

    <div class="modal" id="transactionModal">
        <div class="modal-card">
            <h3 id="transactionModalTitle">Add Transaction</h3>
            <form id="transactionForm">
                <input type="hidden" id="txEditId">
                <div class="grid-2">
                    <div class="field">
                        <label for="txDetail">Transaction Detail</label>
                        <input class="input" id="txDetail" required type="text" placeholder="Rent payment, client invoice, fuel expense, etc.">
                    </div>
                    <div class="field">
                        <label for="txAmount">Amount (PKR)</label>
                        <input class="input" id="txAmount" required type="number" min="0" step="0.01">
                    </div>
                    <div class="field">
                        <label for="txFlowType">Transaction Type</label>
                        <select class="select" id="txFlowType" required></select>
                    </div>
                    <div class="field">
                        <label for="txAccount">Account</label>
                        <select class="select" id="txAccount" required></select>
                    </div>
                    <div class="field">
                        <label for="txHead">Head / Category</label>
                        <select class="select" id="txHead" required></select>
                    </div>
                    <div class="field">
                        <label for="txDate">Event Date (optional)</label>
                        <input class="input" id="txDate" type="text" placeholder="17-01-2026 or 2026-01-17">
                    </div>
                    <div class="field">
                        <label for="txTime">Event Time (optional)</label>
                        <input class="input" id="txTime" type="text" placeholder="14:30">
                    </div>
                </div>
                <div class="field">
                    <label for="txNotes">Remarks / Notes</label>
                    <textarea class="textarea" id="txNotes" placeholder="Add notes, edits, references"></textarea>
                </div>
                <div class="helper" id="txMetaInfo"></div>
                <div class="btn-row mt-2">
                    <button class="btn btn-primary" type="submit" id="saveTransactionBtn">Save Transaction</button>
                    <button class="btn btn-soft" type="button" id="closeTransactionModalBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <datalist id="accountList"></datalist>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script type="module" src="dashboard.js"></script>
</body>
</html>
